# IEC 62304 — Software-Lebenszyklus für Medizinprodukte

> Anwendbar auf PDMS Home-Spital als Software-Medizinprodukt im Schweizer Gesundheitswesen.

---

## 1. Klassifizierung

| Attribut | Wert |
|---|---|
| **Sicherheitsklasse** | Klasse B (nicht-lebensbedrohlich, kann Verletzung verursachen) |
| **Begründung** | Vitaldaten-Alarme unterstützen klinische Entscheidungen; Fehleingaben könnten zu verzögerter Intervention führen. Keine direkte Steuerung von Geräten. |
| **Regulatorischer Pfad** | MDR Klasse IIa (Rule 11 — Software als Medizinprodukt) |

---

## 2. Dokumentations-Checkliste

### 2.1 Software-Entwicklungsplan (SDP)
- [x] Entwicklungsmethodik definiert (Agile/Scrum, 2-Wochen-Sprints)
- [x] Technologie-Stack dokumentiert (FastAPI, Next.js, PostgreSQL)
- [x] Code-Standards definiert (Type-Hints, Docstrings, Linting)
- [x] Branching-Strategie (`feature/`, `fix/`, `refactor/`)
- [x] Review-Prozess (Code Review, PR-basiert)

### 2.2 Software-Anforderungsspezifikation (SRS)
- [x] Funktionale Anforderungen (32+ API-Module, 203+ Endpoints)
- [x] Nicht-funktionale Anforderungen (Latenz <500ms, RPi5-kompatibel)
- [x] Benutzerrollen und Berechtigungen (RBAC: arzt, pflege, admin)
- [x] Datenschutz-Anforderungen (nDSG, AHV-Nummern, PHI-Schutz)
- [ ] Formale Anforderungs-IDs und Traceability-Matrix

### 2.3 Software-Architektur (SAD)
- [x] 6-Schichten-Architektur dokumentiert
- [x] Komponentendiagramm (Monorepo-Struktur)
- [x] Datenflussdiagramme (Vitaldaten-Pipeline, Cache-Aside, Events)
- [x] Schnittstellen-Spezifikation (REST API, WebSocket, FHIR R4)
- [x] Sicherheitsarchitektur (Keycloak OIDC, JWT, RBAC, TLS)

### 2.4 Software-Design (SDD)
- [x] Monorepo-Struktur mit pnpm Workspace
- [x] DB-Schema (38+ Tabellen, TimescaleDB Hypertables)
- [x] Domain-Modelle (SQLAlchemy 2.x Mapped-Syntax)
- [x] API-Design (REST, Pydantic v2 Schemas, OpenAPI 3.1)
- [x] Event-Architektur (RabbitMQ Topic Exchange, 21 Event-Typen)

### 2.5 Software-Verifikation
- [x] Unit-Tests (pytest, 444+ Tests, Mock-basiert)
- [x] API-Tests (httpx AsyncClient, Rollenbasiert)
- [ ] Integrationstests mit echter Datenbank
- [ ] E2E-Tests (Playwright konfiguriert, Tests ausstehend)
- [ ] Lasttest / Performance-Tests (RPi5-Zielplattform)
- [ ] Statische Code-Analyse (mypy, ruff konfiguriert)

### 2.6 Software-Risikomanagement
- [x] Alarm-Grenzwerte für Vitaldaten (7 Parameter, konfigurierbar)
- [x] Audit-Trail für alle Datenmutationen
- [x] RBAC-Zugriffskontrolle auf Endpoint-Ebene
- [ ] Formale FMEA (Failure Mode and Effects Analysis)
- [ ] Risiko-Akzeptanz-Matrix
- [ ] Risiko-Kontroll-Massnahmen dokumentiert

### 2.7 Software-Release
- [x] Docker-basiertes Deployment (docker-compose.yml)
- [x] Produktions-Konfiguration (docker-compose.prod.yml)
- [x] Alembic-Migrationen (versioniert, reproduzierbar)
- [ ] Formaler Release-Prozess mit Checkliste
- [ ] Installations-Qualifikation (IQ/OQ/PQ)
- [ ] Versions-Kennzeichnung (SemVer + UDI)

---

## 3. Prozess-Anforderungen nach IEC 62304

### 3.1 Konfigurationsmanagement
- **VCS:** Git (GitHub)
- **Branching:** Feature-basiert mit PR-Reviews
- **Artefakte:** Docker Images (versioniert)
- **DB-Migrationen:** Alembic (eine Migration pro Feature)

### 3.2 Problem-Lösung (Bug Tracking)
- **Tool:** GitHub Issues
- **Klassifizierung:** Bug / Feature / Security
- **Eskalation:** Sicherheitsrelevante Bugs → sofortige Behebung

### 3.3 Change Management
- Alle Änderungen durch Pull Requests
- Mindestens 1 Review vor Merge
- Automatisierte Tests als Merge-Gate
- Audit-Log für Datenbank-Änderungen

---

## 4. Offene Punkte (Roadmap)

| # | Massnahme | Priorität | Ziel-Phase |
|---|---|---|---|
| 1 | Formale Anforderungs-Traceability | Hoch | Phase 5 |
| 2 | FMEA durchführen | Hoch | Phase 5 |
| 3 | E2E-Tests implementieren | Mittel | Phase 5 |
| 4 | Integrationstests mit echter DB | Mittel | Phase 5 |
| 5 | Release-Prozess formalisieren | Mittel | Phase 6 |
| 6 | IQ/OQ/PQ Dokumente | Niedrig | Phase 6 |
| 7 | UDI-Kennzeichnung | Niedrig | Phase 6 |

---

*Letzte Aktualisierung: Phase 4 — Stand nach Implementation der FHIR R4 Endpoints und 444 Tests.*
